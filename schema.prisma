
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ù…Ø¹Ø¯Ù„)
model User {
  id            String         @id @default(uuid())
  userName      String?        
  email         String         @unique
  googleId      String?        @unique
  password      String?        
  roleId        String?       
  userImage     String?       
  products      Product[]
  reviews       Review[]
  favorites     Favorite[]
  orders        Order[]
  payments      Payment[]
  notifications Notification[]
  reports       Report[]
  recommendations Recommendation[]
  role          Role?          @relation(fields: [roleId], references: [id], onDelete: SetNull)
  
  @@map("users")
  @@index([userName])
  @@index([email])
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ù…Ø¹Ø¯Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)
model Product {
  id              String         @id @default(uuid())
  title           String
  userId          String
  userImage       String?
  userName        String?
  categoryId      Int           @default(1)
  categoryName    String  
  images          String[]      // ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ array Ù„ØªØ®Ø²ÙŠÙ† multiple images
  basePrice       Int?
  adCategory      String?
  city            String?
  town            String?
  phoneNumber     String?
  lng             Float?
  lat             Float?
  link            String?       @default("")
  details         Json?
  description     String?
  stockQuantity   Int?          @default(1)
  isDeleted       Boolean       @default(false)
  deletedAt       DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  favorites       Favorite[]
  reviews         Review[]
  orders          Order[]
  recommendations Recommendation[]
  priceHistory    ProductPriceHistory[]
  inventory       Inventory[]
  discounts       Discount[]
  translations    ProductTranslation[]

  @@map("products")
  @@index([userId])
  @@index([categoryId])
  @@index([basePrice])
  @@index([city])
  @@index([isDeleted])
  @@index([createdAt])
}


// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙØ¶Ù„Ø©
model Favorite {
  id        String   @id @default(uuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  isDeleted Boolean  @default(false)
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId]) // Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªÙƒØ±Ø§Ø± Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù…Ù†ØªØ¬
}
// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµÙˆØ±
model ProductImage {
  id         String   @id @default(uuid())
  productId  String
  image1        String   // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„ØµÙˆØ±Ø©
  image2        String   // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„ØµÙˆØ±Ø©
  image3        String   // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„ØµÙˆØ±Ø©
  image4        String   // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„ØµÙˆØ±Ø©
  image5        String   // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„ØµÙˆØ±Ø©
  isPrimary  Boolean  @default(false)
  // product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
model Role {
  id          String       @id @default(uuid())
  name        String       @unique
  permissions Permission[]
  users       User[]
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
model Permission {
  id    String   @id @default(uuid())
  name  String   @unique
  roles Role[]
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ¦Ø§Øª
model Category {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  // products    Product[]
  @@index([name])
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙˆÙ„
model Country {
  id      String   @id @default(uuid())
  name    String   @unique
  code    String   @unique // e.g., "US", "AE"
  cities  City[]
  // products Product[]
  suppliers Supplier[]
  @@index([name])
  @@index([code])
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ù†
model City {
  id        String   @id @default(uuid())
  name      String   @unique
  countryId String
  country   Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
  // products  Product[]
  suppliers Supplier[]
  @@index([name])
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
model Supplier {
  id        String   @id @default(uuid())
  name      String   @unique
  email     String   @unique
  phone     String?
  address   String?
  countryId String
  cityId    String?
  // products  Product[]
  country   Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
  city      City?    @relation(fields: [cityId], references: [id], onDelete: SetNull)
  @@index([name])
  @@index([email])
}



// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
model Inventory {
  id          String   @id @default(uuid())
  productId   String
  quantity    Int
  isAvailable Boolean  @default(true)
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
model ProductTranslation {
  id          String   @id @default(uuid())
  productId   String
  language    String   // e.g., "ar", "en", "fr"
  title       String
  description String?
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  @@unique([productId, language])
  @@index([language])
  @@index([title])
  @@index([description])
}



// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
model ProductPriceHistory {
  id        String   @id @default(uuid())
  productId String
  price     Int
  changedAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}


// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
model Review {
  id        String   @id @default(uuid())
  userId    String
  productId String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
model Order {
  id              String   @id @default(uuid())
  userId          String
  productId       String
  discountId      String?
  shippingMethodId String?
  quantity        Int
  totalPrice      Int
  status          String                  // e.g., "pending", "shipped", "delivered"
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  user            User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product         Product                 @relation(fields: [productId], references: [id], onDelete: Cascade)
  payments        Payment[]
  discount        Discount?               @relation(fields: [discountId], references: [id], onDelete: SetNull)
  shipping        Shipping[]
  returns         Return[]
  shippingMethod  ShippingMethod?         @relation(fields: [shippingMethodId], references: [id], onDelete: SetNull)
  @@index([status])
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
model Payment {
  id        String   @id @default(uuid())
  orderId   String
  userId    String
  amount    Int
  method    String   // e.g., "credit_card", "paypal"
  status    String   // e.g., "pending", "completed", "failed"
  createdAt DateTime @default(now())
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@index([status])
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶
model Discount {
  id        String   @id @default(uuid())
  productId String
  code      String   @unique
  percentage Int
  validFrom DateTime
  validTo   DateTime
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  orders    Order[]
  @@index([code])
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ø­Ù†
model Shipping {
  id             String   @id @default(uuid())
  orderId        String
  status         String   // e.g., "pending", "shipped", "delivered"
  trackingNumber String?
  createdAt      DateTime @default(now())
  order          Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  @@index([status])
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª
model Return {
  id           String   @id @default(uuid())
  orderId      String
  reason       String
  status       String   // e.g., "pending", "approved", "rejected"
  refundAmount Float?
  createdAt    DateTime @default(now())
  order        Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  @@index([status])
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
model Notification {
  id        String   @id @default(uuid())
  userId    String
  type      String   // e.g., "order", "shipping", "promotion"
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
model Report {
  id        String   @id @default(uuid())
  userId    String
  type      String   // e.g., "sales", "performance"
  data      Json
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙˆØµÙŠØ§Øª
model Recommendation {
  id        String   @id @default(uuid())
  userId    String
  productId String
  score     Float
  reason    String?  // e.g., "similar products", "popular in your area"
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// ğŸŸ¢ Ø¬Ø¯ÙˆÙ„ Ø·Ø±Ù‚ Ø§Ù„Ø´Ø­Ù†
model ShippingMethod {
  id        String   @id @default(uuid())
  name      String
  cost      Float
  orders    Order[]
}